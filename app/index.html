<!DOCTYPE html>
<html lang="pl">

<head>
    <link rel="stylesheet" id="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" href="../src/icons/192.png">
    <link rel="shortcut icon" href="../src/icons/192.png">
    <link rel="manifest" id="manifest">
    <meta name=”theme-color” content=”#d7e5ef″>
    <title>
        Mobilny Katolik
    </title>
    <link rel="icon" type="image/png" href="../src/icons/192.png" />
    <script src="https://connect.facebook.net/en_US/sdk.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js" crossorigin="anonymous" defer></script>-->
    <link href="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css" rel="stylesheet" crossorigin="anonymous">
</head>


<body>

<div class="startup-logo" id="startup-logo-introduction">
    <div id="startup-logo-icon-introduction">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 1791.000000 1097.000000" preserveAspectRatio="xMidYMid meet" class="startup-logo">
            <g transform="translate(0.000000,1097.000000) scale(0.100000,-0.100000)" stroke="none" id="startup-logo-icon-color" style="fill: var(--theme-color); transition: fill 0.5s ease;">
            <path d="M7258 10965 c-4 -6 -15 -51 -25 -100 -25 -127 -25 -494 0 -650 28 -177 81 -398 176 -741 175 -632 204 -793 205 -1139 1 -189 -3 -260 -17 -334 -10 -52 -16 -96 -13 -98 8 -8 119 181 172 292 102 212 140 375 131 555 -10 185 -44 293 -209 660 -216 482 -288 694 -352 1040 -23 122 -52 365 -58 480 -2 25 -6 40 -10 35z"/>
            <path d="M7035 9693 c-21 -54 -67 -186 -102 -293 -287 -862 -265 -1400 65 -1653 59 -45 121 -81 128 -75 2 3 -10 67 -27 144 -95 431 -106 736 -48 1369 19 220 37 605 27 605 -3 0 -22 -44 -43 -97z"/>
            <path d="M7275 7601 c6 -4 185 -77 400 -161 214 -84 747 -294 1185 -467 1705 -675 2235 -875 2875 -1086 573 -189 1001 -299 1425 -367 427 -68 934 -68 1303 0 627 115 1244 397 2059 941 261 175 476 325 530 373 103 90 188 220 223 341 24 80 17 214 -13 271 -27 54 -100 118 -160 141 -45 17 -231 18 -4942 21 -2762 1 -4890 -2 -4885 -7z m9659 -291 c55 -61 47 -118 -26 -186 -39 -37 -760 -566 -867 -636 -129 -85 -191 -88 -258 -15 -130 141 -180 353 -124 519 53 158 213 313 358 347 21 5 228 9 459 10 l422 1 36 -40z"/>
            <path d="M4455 6175 c-1047 -92 -1968 -458 -2825 -1125 -224 -175 -421 -350 -660 -590 -317 -316 -549 -584 -837 -963 l-134 -178 70 -78 c39 -43 126 -132 194 -197 1126 -1089 2786 -1735 4762 -1854 231 -14 877 -14 1110 0 802 48 1495 164 2267 379 1391 388 2496 622 3418 725 405 45 509 51 950 51 347 0 454 -3 585 -18 1116 -128 1806 -547 2351 -1430 105 -169 268 -484 369 -712 36 -82 71 -154 76 -160 6 -5 -3 22 -19 60 -17 39 -247 581 -512 1205 -265 624 -500 1182 -522 1239 -135 358 -116 565 75 806 40 51 530 518 1400 1338 736 692 1336 1262 1333 1264 -11 11 -355 -247 -771 -577 -551 -437 -741 -579 -1009 -755 -664 -435 -1325 -677 -2056 -751 -147 -15 -171 -15 -322 0 -700 71 -1469 247 -2372 543 -451 148 -788 268 -1686 603 -813 303 -1145 422 -1590 571 -1031 344 -1775 517 -2559 595 -221 22 -874 27 -1086 9z m2123 -960 c393 -50 842 -170 1322 -355 96 -37 1041 -385 2100 -775 1059 -390 1928 -711 1933 -715 4 -4 -127 -48 -290 -98 -1762 -540 -3506 -848 -5413 -957 -451 -25 -773 -35 -1377 -42 l-583 -6 0 169 c0 758 113 1382 329 1829 289 597 743 906 1421 969 90 8 438 -3 558 -19z"/>
            </g>
        </svg>
    </div>
</div>

<div class="splash-screen" id="splash-screen">
    <div class="startup-logo" id="startup-logo">
        <div id="startup-logo-loading">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
                <circle cx="50" cy="50" fill="none" style="stroke: var(--theme-color); transition: stroke 0.5s ease;" stroke-width="2" r="35" stroke-dasharray="164.93361431346415 56.97787143782138" id="startup-logo-loading-color">
                <animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform>
                </circle>
            </svg>
        </div>
        <div id="startup-logo-icon">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 1791.000000 1097.000000" preserveAspectRatio="xMidYMid meet" class="startup-logo">
                <g transform="translate(0.000000,1097.000000) scale(0.100000,-0.100000)" stroke="none" id="startup-logo-icon-color" style="fill: var(--theme-color); transition: fill 0.5s ease;">
                <path d="M7258 10965 c-4 -6 -15 -51 -25 -100 -25 -127 -25 -494 0 -650 28 -177 81 -398 176 -741 175 -632 204 -793 205 -1139 1 -189 -3 -260 -17 -334 -10 -52 -16 -96 -13 -98 8 -8 119 181 172 292 102 212 140 375 131 555 -10 185 -44 293 -209 660 -216 482 -288 694 -352 1040 -23 122 -52 365 -58 480 -2 25 -6 40 -10 35z"/>
                <path d="M7035 9693 c-21 -54 -67 -186 -102 -293 -287 -862 -265 -1400 65 -1653 59 -45 121 -81 128 -75 2 3 -10 67 -27 144 -95 431 -106 736 -48 1369 19 220 37 605 27 605 -3 0 -22 -44 -43 -97z"/>
                <path d="M7275 7601 c6 -4 185 -77 400 -161 214 -84 747 -294 1185 -467 1705 -675 2235 -875 2875 -1086 573 -189 1001 -299 1425 -367 427 -68 934 -68 1303 0 627 115 1244 397 2059 941 261 175 476 325 530 373 103 90 188 220 223 341 24 80 17 214 -13 271 -27 54 -100 118 -160 141 -45 17 -231 18 -4942 21 -2762 1 -4890 -2 -4885 -7z m9659 -291 c55 -61 47 -118 -26 -186 -39 -37 -760 -566 -867 -636 -129 -85 -191 -88 -258 -15 -130 141 -180 353 -124 519 53 158 213 313 358 347 21 5 228 9 459 10 l422 1 36 -40z"/>
                <path d="M4455 6175 c-1047 -92 -1968 -458 -2825 -1125 -224 -175 -421 -350 -660 -590 -317 -316 -549 -584 -837 -963 l-134 -178 70 -78 c39 -43 126 -132 194 -197 1126 -1089 2786 -1735 4762 -1854 231 -14 877 -14 1110 0 802 48 1495 164 2267 379 1391 388 2496 622 3418 725 405 45 509 51 950 51 347 0 454 -3 585 -18 1116 -128 1806 -547 2351 -1430 105 -169 268 -484 369 -712 36 -82 71 -154 76 -160 6 -5 -3 22 -19 60 -17 39 -247 581 -512 1205 -265 624 -500 1182 -522 1239 -135 358 -116 565 75 806 40 51 530 518 1400 1338 736 692 1336 1262 1333 1264 -11 11 -355 -247 -771 -577 -551 -437 -741 -579 -1009 -755 -664 -435 -1325 -677 -2056 -751 -147 -15 -171 -15 -322 0 -700 71 -1469 247 -2372 543 -451 148 -788 268 -1686 603 -813 303 -1145 422 -1590 571 -1031 344 -1775 517 -2559 595 -221 22 -874 27 -1086 9z m2123 -960 c393 -50 842 -170 1322 -355 96 -37 1041 -385 2100 -775 1059 -390 1928 -711 1933 -715 4 -4 -127 -48 -290 -98 -1762 -540 -3506 -848 -5413 -957 -451 -25 -773 -35 -1377 -42 l-583 -6 0 169 c0 758 113 1382 329 1829 289 597 743 906 1421 969 90 8 438 -3 558 -19z"/>
                </g>
            </svg>
        </div>
    </div>
</div>

<div class="blur-screen" id="blur-screen">
    <div class="popup" id="popup">
        [text]
    </div>
</div>

<div class="introduction" id="introduction">
    <div style="margin-top: 80px; padding: 20px; height: calc(100% - 200px);">
        <h1>Witaj w <b style="font-weight: 500;" class="highlight">Mobilnym Katoliku</b></h1>
        <div style="height: 4px; width: 100%; display: flex; margin: 20px 0 35px 0; background-color: var(--additional2); border-radius: 10px;">
            <div id="introduction-progress-bar"></div>
        </div>
        <div class="introduction-page" id="introduction-step-1">
            <p style="color: darkgray; font-size: 17px;">Jak mamy się do Ciebie zwracać?</p>
            <form onSubmit="return introductionNextStep();">
                <input type="text" placeholder="Imię/pseudonim" id="introduction-nickname">
                <div style="position: fixed; bottom: 0; margin-bottom: 20px; width: 100%; left: 0;">
                    <input type="submit" class="introduction-button-next" value="Dalej">
                </div>
            </form>
        </div>
        <div class="introduction-page" id="introduction-step-2">
            <p style="color: darkgray; font-size: 17px;">Zaloguj się na swój Profil Mobilny<br>Jeśli strona logowania nie otwiera się automatycznie, kliknij przycisk poniżej</p>
            <button type="button" class="introduction-button-next" style="display: block; margin: auto; margin-top: 20px; float: unset;" onClick="openLoginPopup();">Zaloguj się</button>
        </div>
        <div class="introduction-page" id="introduction-step-3">
            <p style="color: darkgray; font-size: 17px;">Czy chcesz otrzymywać powiadomienia z aplikacji?</p>
            <button type="button" id="introduction-ask-for-permission" class="introduction-button-next" style="display: block; margin: auto; margin-top: 20px; float: unset;" onClick="askForPermission();">Przyznaj uprawnienia</button>
            <div style="position: fixed; bottom: 0; margin-bottom: 20px; width: 100%; left: 0;">
                <button class="introduction-button-next" onclick="introductionNextStep();">Pomiń</button>
            </div>
        </div>
        <div class="introduction-page" id="introduction-step-4">
            <p style="color: darkgray; font-size: 17px;">Możesz wybrać motyw aplikacji</p>
            <div class="buttons-section" type="theme" style="margin-top: 20px;">
                <div type="top" onclick="changeTheme('a80c2f');">
                    <aside id="introduction-theme-a80c2f" style="background-color: #a80c2f;"></aside>
                    <span>Domyślny</span>
                </div>
                <div onclick="changeTheme('1e6091');">
                    <aside id="introduction-theme-1e6091" style="background-color: #1e6091;"></aside>
                    <span>Głębia oceanu</span>
                </div>
                <div onclick="changeTheme('52796f');">
                    <aside id="introduction-theme-52796f" style="background-color: #52796f;"></aside>
                    <span>Świerkowy las</span>
                </div>
                <div onclick="changeTheme('ea9ab2');">
                    <aside id="introduction-theme-ea9ab2" style="background-color: #ea9ab2;"></aside>
                    <span>Kredowy róż</span>
                </div>
                <div type="bottom" onclick="changeTheme('bd93bd');">
                    <aside id="introduction-theme-bd93bd" style="background-color: #bd93bd;"></aside>
                    <span>Lawendowy fiolet</span>
                </div>
            </div>
            <p style="color: darkgray; font-size: 17px; margin-top: 20px;">Tryb aplikacji</p>
            <div class="buttons-section">
                <select id="introduction-lightmode" onchange="changeLightMode(document.getElementById('introduction-lightmode').value);">
                    <option selected value="default">Domyślny dla ustawień systemu</option>
                    <option value="light">Jasny</option>
                    <option value="dark">Ciemny</option>
                </select>
            </div>
            <div style="position: fixed; bottom: 0; margin-bottom: 20px; width: 100%; left: 0;">
                <button class="introduction-button-next" onclick="introductionNextStep();">Dalej</button>
            </div>
        </div>
        <div class="introduction-page" id="introduction-step-5">
            <p style="color: darkgray; font-size: 17px;">Aplikacja jest w fazie rozwoju. Wszelkie błędy prosimy zgłaszać do administratora (Kuba Sałek) bądź na adres mobilnykatolik@gmail.com</p>
            <div style="position: fixed; bottom: 0; margin-bottom: 20px; width: 100%; left: 0;">
                <button class="introduction-button-next" onclick="introductionNextStep();">Dalej</button>
            </div>
        </div>
        <div class="introduction-page" id="introduction-step-6">
            <p style="color: darkgray; font-size: 17px; text-align: center;">Twój Mobilny Katolik jest już gotowy</p>
            <p style="color: darkgray; font-size: 12px; text-align: center;">Aplikacja zostanie uruchomiona ponownie<br>w celu zapisania zmian</p>
            <button type="button" class="introduction-button-next" style="display: block; margin: auto; margin-top: 20px; float: unset;" onClick="moveStartupLogoBack();">Zaczynamy!</button>
        </div>
    </div>
</div>

<div class="ui" id="ui">

<div class="page" id="home">
    <div style="height: 60px; display: flex; justify-content: space-between; align-items: center;">
        <div style="float: left;">
            <h1>Cześć, <b class="highlight" id="UIname"></b></h1>
            <h3>Miłego dnia</h3>
        </div>
        <div class="profile-pic" id="profile-pic" style="float: right; position: relative;" onclick="window.open('#usersettings', '_self')"></div>
    </div>

    <div style="margin-top: 20px;" class="swiffy-slider slider-item-show2 slider-item-reveal slider-nav-outside slider-nav-round slider-nav-visible slider-indicators-outside slider-indicators-round slider-indicators-dark slider-nav-animation slider-nav-animation-fadein slider-item-first-visible">
        <ul id="home-slider" class="slider-container py-4">
            <li class="slide-visible">
                <div style="height: 130px; background-color: var(--additional2); width: 100%; border-radius: 20px;">
                    <div style="padding: 20px; height: calc(100% - 40px); width: calc(100% - 40px); text-align: center;">
                        <div style="position: absolute; width: 100%; left: 0; top: 50%; translate: 0 -50%;">
                        <p>Witaj w</p>
                        <b class="highlight" style="font-size: 20px;">Mobilnym Katoliku</b> ❤️
                        </div>
                    </div>
                </div>
            </li>
            <li class="slide-visible">
                <div style="height: 130px; background-color: var(--additional2); width: 100%; border-radius: 20px;">
                    <div style="padding: 20px; height: calc(100% - 40px); width: calc(100% - 40px);">
                        Masz
                        <h1 class="highlight" style="font-weight: 600; font-size: 30px;">0</h1>
                        Wirtualnych Rybek
                        <div id="widget-points-qr" style="height: 80%; background-color: #ececec; aspect-ratio: 1/1; border-radius: 5px; background-size: 90%; background-position: center; background-repeat: no-repeat; position: absolute; top: 13px; right: 13px;">

                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <div style="height: 80px; width: 100%; font-size: 14px;">
        <div style="width: calc(100% / 3); height: 100%; float: left;" onclick="window.open('#pointsapp', '_self')">
            <div style="background-color: var(--additional2); height: 80%; aspect-ratio: 1/1; border-radius: 50%; margin: auto; margin-bottom: 5px; line-height: 64px; text-align: center; font-size: 25px;">🐟</div>
            <div style="height: 20%; text-align: center;">Wirtualne rybki</div>
        </div>
        <div style="width: calc(100% / 3); height: 100%; float: left;" onclick="window.open('#ticketsapp', '_self')">
            <div style="background-color: var(--additional2); height: 80%; aspect-ratio: 1/1; border-radius: 50%; margin: auto; margin-bottom: 5px; line-height: 64px; text-align: center; font-size: 25px;">🎫</div>
            <div style="height: 20%; text-align: center;">Bilety i kupony</div>
        </div>
        <div style="width: calc(100% / 3); height: 100%; float: left;" onclick="window.open('#calendar', '_self')">
            <div style="background-color: var(--additional2); height: 80%; aspect-ratio: 1/1; border-radius: 50%; margin: auto; margin-bottom: 5px; line-height: 64px; text-align: center; font-size: 25px;">📅</div>
            <div style="height: 20%; text-align: center;">Kalendarz</div>
        </div>
    </div>
    
</div>

<div class="page" id="app">
    <div class="page-name">
        Więcej
    </div>
    <div class="page-content">
        <div class="buttons-section" type="apps">
            <div type="ind" onclick="window.open('#luckyapp', '_self')">
                <aside>🏅</aside>
                <span>Szczęśliwy numerek</span>
            </div>
            <div type="ind" onclick="window.open(`https://forms.gle/SKZWcXtuj6D2rkbv6`, '_self')">
                <aside>💡</aside>
                <span>Pomysł dla SU</span>
            </div>
            <div type="ind" onClick="openInstagram();">
                <aside>📸</aside>
                <span>Profil SU na Instagramie</span>
            </div>
            <div type="ind" onclick="window.open('#pointsapp', '_self')">
                <aside>🐟</aside>
                <span>Wirtualne rybki</span>
            </div>
            <div type="ind" onclick="window.open('#ticketsapp', '_self')">
                <aside>🎫</aside>
                <span>Bilety i kupony</span>
                <!--<container>#WKRÓTCE</container>-->
            </div>
        </div>
    </div>
</div>

<div class="page" id="luckyapp">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Szczęśliwy numerek
    </div>
    <div class="page-content">
        <p style="font-size: 18px; text-align: center; display: none;" id="no-luckynumber">Aktualnie nie ma szczęśliwego numerka.</p>
        <div id="ln-today" style="margin-bottom: 20px; display: none;">
            <p style="font-size: 18px; text-align: center;" id="ln-today-date"></p>
            <table class="luckynumber" style="width: 100%; margin-top: 10px;" id="ln-today-table">
            </table>
        </div>
        <div id="ln-tomorrow" style="display: none;">
            <p style="font-size: 18px; text-align: center;" id="ln-tomorrow-date"></p>
            <table class="luckynumber" style="width: 100%; margin-top: 10px;" id="ln-tomorrow-table">
            </table>
        </div>
    </div>
</div>

<div class="page" id="pointsapp">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Wirtualne rybki
    </div>
    <div class="page-content">
        <div class="page-content">
            <div style="width: 100%;height: 130px;background-color: var(--additional);border-radius: 10px;">
                <div class="points-ring" style="height: 70%; aspect-ratio: 1/1; top: 50%; position: relative; translate: 15px -50%; border: 3px solid var(--theme-color); border-radius: 50%; text-align: center; font-size: 30px; line-height: 91px;">0
                    <div style="width: 45%; height: 20px; background-color: var(--additional); margin: auto; position: relative; top: -15px; border-radius: 40px; line-height: 100%; font-size: 23px;">🐟</div>
                </div>
            </div>
            <h3 style="margin-top: 20px;">❔Jak zdobywać Wirtualne Rybki?</h3>
            <span style="font-size: 14px; opacity: 60%;">W zamian za udział w akcjach Samorządu Uczniowskiego przyznajemy punkty (Wirtualne Rybki). Pokaż swój kod QR członkowi SU, aby zdobyć punkty i wymieniać je na nagrody.</span>
            <h3 style="margin-top: 10px;">❔W jaki sposób naliczane są punkty?</h3>
            <span style="font-size: 14px; opacity: 60%;">Za każdą złotówkę otrzymasz 5 punktów. Możesz również otrzymać punkty za udział w akcji.</span>
            <h3 style="margin-top: 10px;">❔Rybki nie pojawiły się w aplikacji?</h3>
            <span style="font-size: 14px; opacity: 60%;">Zgłoś to jak najszybciej za pomocą formularza Zgłoś błąd.</span>
        </div>
    </div>
</div>

<div class="page" id="ticketsapp">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Bilety i kupony
    </div>
    <div class="page-content">
        <p style="font-size: 18px;">Twoje bilety</p>
        <div style="margin-top: 10px;" class="swiffy-slider slider-item-show2 slider-item-reveal slider-nav-outside slider-nav-round slider-nav-visible slider-indicators-outside slider-indicators-round slider-indicators-dark slider-nav-animation slider-nav-animation-fadein slider-item-first-visible">
            <ul id="my-tickets" class="slider-container py-4">
            </ul>
        </div>
        <p style="font-size: 18px;">Dostępne bilety</p>
        <div style="margin-top: 10px;" class="swiffy-slider slider-item-show2 slider-item-reveal slider-nav-outside slider-nav-round slider-nav-visible slider-indicators-outside slider-indicators-round slider-indicators-dark slider-nav-animation slider-nav-animation-fadein slider-item-first-visible">
            <ul id="available-tickets" class="slider-container py-4">
                <li class="slide-visible" id="crime-party-available" style="display: none;">
                    <div style="height: 130px; background-color: #000000; width: 100%; border-radius: 20px;">
                        <div style="padding: 20px; height: calc(100% - 40px); width: calc(100% - 40px);">
                            <div style="height: 130px; aspect-ratio: 1/1; position: absolute; top: 0; right: 0; border-radius: 0px 20px 20px 0px; background-size: 100%; background-position: center; background-repeat: no-repeat; background-image: url('https://i.imgur.com/LUw9eul.png')"></div>
                            <div style="position: absolute; top: 50%; translate: 0 -50%; width: calc(100% - 40px);">
                                <p style="color: #ffffff;">Crime Party</p>
                                <button type="button" style="margin: unset; margin-top: 5px;" onclick="window.open('#getticketapp', '_self')">20,00 zł</button>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="page" id="order">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Zamówienie
    </div>
    <div class="page-content">
        <p style="font-size: 15px;">ID zamówienia</p>
        <p style="font-size: 18px; margin-bottom: 10px;" id="order-id"></p>
        <p style="font-size: 15px;">Status</p>
        <p style="font-size: 18px; margin-bottom: 10px;" id="order-status">Nowe zamówienie</p>
        <p style="font-size: 15px;">Suma</p>
        <p style="font-size: 18px; margin-bottom: 10px;" id="order-price">0,00 zł</p>
        <p style="font-size: 15px;">Pozostało do zapłaty</p>
        <p style="font-size: 18px; margin-bottom: 10px;" id="order-cost">0,00 zł</p>
        <table class="order-details" style="width: 100%; font-size: 15px; margin-bottom: 10px;" id="order-details">
        </table>
        <p style="font-size: 15px;">Inne informacje</p>
        <p style="font-size: 18px; margin-bottom: 10px;">
            Wpłaty przyjmujemy do 27 października. W innym wypadku zamówienie zostanie anulowane.<br><br>
            Gotówka<br>Wpłaty przyjmuje Kuba Sałek<br><br>Przelew<br>Wykonaj przelew na ponisze dane:<br><br>
            <b>Zespół Szkół Katolickich</b><br>
            <b>78 8345 0006 2002 0027 7864 0002</b><br>
            tytułem <b id="order-payment-title"></b>

        </p>
    </div>
</div>

<div class="page" id="ticket">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Bilet
    </div>
    <div class="page-content">
        <div class="ticket">
            <div class="ticket-banner" id="ticket-banner"></div>
            <div style="padding: 10px;">
                <h1 id="ticket-name">-</h1>
                <p id="ticket-state" style="font-size: 15px; color: #000000;">Bilet aktywny</p>
                <p style="margin-top: 20px; opacity: 75%; font-size: 15px;">Data</p>
                <h3 id="ticket-date">-</h3>
                <p style="margin-top: 5px; opacity: 75%; font-size: 15px;">Godzina</p>
                <h3 id="ticket-time">-</h3>
                <p style="margin-top: 5px; opacity: 75%; font-size: 15px;">Miejsce</p>
                <h3 id="ticket-place">-</h3>
            </div>
            <div class="ticket-qr" id="ticket-qr"></div>
        </div>
    </div>
</div>

<div class="page" id="getticketapp">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Kup bilet/kupon
    </div>
    <div class="page-content">
        <p style="text-align: center; margin-bottom: 10px;">Crime Party</p>
        <p style="font-size: 18px;">Informacje o wydarzeniu</p>
        <p style="font-size: 15px; margin-bottom: 10px;">10 listopada, 17:00-23:00<br>Aula ZSK, ul. Wodna 6, Tczew</p>
        <p style="font-size: 15px; margin-bottom: 10px;">Ze względu na charakter wydarzenia, wymagana jest zgoda rodzica/opiekuna prawnego.</p>
        <p style="font-size: 15px; margin-bottom: 10px;">Dostępne sposoby płatności: Gotówka</p>
        <p style="font-size: 15px; margin-bottom: 10px; color: #ff0000; text-align: center; font-weight: bold;">Sprzedaż rozpoczyna się 23.10.2023 r., godz. 9:15</p>
        <p style="font-size: 18px; margin-bottom: 10px; margin-top: 20px; text-align: center;">Do zapłaty: 20,00 zł</p>
        <button type="button" id="buy-ticket-button" onClick="buyTicket('a')">Zamawiam z obowiązkiem zapłaty</button>
    </div>
</div>

<div class="page" id="calendar">
    <div class="page-name">
        Kalendarz
    </div>
    <div class="page-content">
        <center style="margin-bottom: 5px;"><container class="soon">#WKRÓTCE</container></center>
        <center>
            Jeszcze pracujemy nad tym modułem...
        </center>
        <br><br>
        Październik 2023:
        <ul>
            <li>09-27.10 - Sprzedaż bluz, toreb i workoplecaków</li>
            <li>13.10 - Dzień Nauczyciela</li>
        </ul>
        Listopad 2023:
        <ul>
            <li>10.11 - Crime Party (UKLO)</li>
        </ul>
    </div>
</div>

<div class="page" id="settings">
    <div class="page-name">
        Ustawienia
    </div>
    <div class="page-content">
        <div class="buttons-section" type="apps">
            <div type="top" onclick="window.open('#usersettings', '_self')">
                <aside>🔑</aside>
                <span>Twoje dane</span>
            </div>
            <div onclick="window.open('#appearancesettings', '_self')">
                <aside>🪄</aside>
                <span>Personalizacja</span>
            </div>
            <div onclick="window.open('#notificationssettings', '_self')">
                <aside>🔔</aside>
                <span>Powiadomienia</span>
                <container>#WKRÓTCE</container>
            </div>
            <div onclick="window.open('#authorsettings', '_self')">
                <aside>🧑‍💻</aside>
                <span>Twórcy</span>
            </div>
            <div type="bottom" onclick="window.open('#infosettings', '_self')">
                <aside>ℹ️</aside>
                <span>Informacje</span>
            </div>
        </div>
    </div>
</div>

<div class="page" id="usersettings">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Twoje dane
    </div>
    <div class="page-content">
        <p style="font-size: 18px;">Pseudonim</p>
        <p style="font-size: 15px; margin-bottom: 10px;">Nazwa wyświetlana w aplikacji</p>
        <input type="text" placeholder="Pseudonim/imię" id="UInickname" maxlength="15" onchange="nicknameChange();">
        <br>
        <p style="font-size: 18px;">Dane osobowe</p>
        <span style="font-size: 14px; opacity: 60%;">W trosce o bezpieczeństwo Twoich danych osobowych, ich zmiana jest możliwa wyłącznie poprzez kontakt z administratorem.</span>
        <input type="text" placeholder="Imię" id="UIfirstname" style="margin-top: 10px;" disabled>
        <input type="text" placeholder="Nazwisko" id="UIsurname" disabled>
        <input type="text" placeholder="Klasa" id="UIclass" disabled>
        <br><br>
        <button type="button" id="usersettings-save" onclick="userSettingsSave();" disabled>Zapisz zmiany</button>
    </div>
</div>

<div class="page" id="appearancesettings">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Personalizacja
    </div>
    <div class="page-content">
        <p style="font-size: 18px;">Motyw aplikacji</p>
        <p style="font-size: 15px;">Wybierz kolor przewodni</p>
        <div class="buttons-section" type="theme" style="margin-top: 20px; margin-bottom: 20px">
            <div type="top" onclick="changeTheme('a80c2f');">
                <aside id="theme-a80c2f" style="background-color: #a80c2f;"></aside>
                <span>Domyślny</span>
            </div>
            <div onclick="changeTheme('1e6091');">
                <aside id="theme-1e6091" style="background-color: #1e6091;"></aside>
                <span>Głębia oceanu</span>
            </div>
            <div onclick="changeTheme('52796f');">
                <aside id="theme-52796f" style="background-color: #52796f;"></aside>
                <span>Świerkowy las</span>
            </div>
            <div onclick="changeTheme('ea9ab2');">
                <aside id="theme-ea9ab2" style="background-color: #ea9ab2;"></aside>
                <span>Kredowy róż</span>
            </div>
            <div type="bottom" onclick="changeTheme('bd93bd');">
                <aside id="theme-bd93bd" style="background-color: #bd93bd;"></aside>
                <span>Lawendowy fiolet</span>
            </div>
        </div>
        <p style="font-size: 18px;">Tryb podświetlenia</p>
        <p style="font-size: 15px;">Aby zastosować zmiany, uruchom ponownie aplikację</p>
        <div class="buttons-section">
            <select id="lightmode" onchange="changeLightMode(document.getElementById('lightmode').value);">
                <option selected value="default">Domyślny dla ustawień systemu</option>
                <option value="light">Jasny</option>
                <option value="dark">Ciemny</option>
            </select>
        </div>
    </div>
</div>

<div class="page" id="notificationssettings">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Powiadomienia
    </div>
    <div class="page-content">
        <div class="buttons-section" type="people">
            <div type="ind">
                <aside>
                    <input type="checkbox" id="notificationssettings-switch" onchange="switchNotifications();">
                </aside>
                <span>
                    Włącz powiadomienia
                </span>
            </div>
        </div>
        <div id="notificationssettings-details" style="display: none;">
            <table style="width: 100%;">
                <tr>
                    <td style="width: 23px;"><input type="checkbox" style="position: unset;" checked disabled></td>
                    <td>Szczęśliwy numerek<br><p style="font-size: 14px; opacity: 60%;"></p></td>
                </tr>
                <tr>
                    <td style="width: 23px;"><input type="checkbox" style="position: unset;" checked disabled></td>
                    <td>Wydarzenia z kalendarza<br><p style="font-size: 14px; opacity: 60%;">Dotyczy tylko wydarzeń szkolnych i SU</p></td>
                </tr>
                <tr>
                    <td style="width: 23px;"><input type="checkbox" style="position: unset;" checked disabled></td>
                    <td>Wirtualne rybki<br><p style="font-size: 14px; opacity: 60%;"></p></td>
                </tr>
                <tr>
                    <td style="width: 23px;"><input type="checkbox" style="position: unset;" checked disabled></td>
                    <td>Zamówienia, bilety, kupony<br><p style="font-size: 14px; opacity: 60%;"></p></td>
                </tr>
            </table>
            <span style="font-size: 14px; opacity: 60%;">Wciąż pracujemy nad powiadomieniami, dlatego niektóre z ustawień wciąż mogą nie działać prawidłowo. Za utrudnienia przepraszamy!</span>
        </div>
    </div>
</div>

<div class="page" id="authorsettings">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Twórcy
    </div>
    <div class="page-content">
        <div class="buttons-section" type="people">
            <div type="top">
                <aside style="background-image: url('https://i.imgur.com/udhPKa2.png');"></aside>
                <span>
                    Kuba Sałek
                    <br><i>App Developer, API</i>
                </span>
            </div>
            <div>
                <aside style="background-image: url('https://i.imgur.com/pyt4e1s.jpg')"></aside>
                <span>
                    Filip Zalewski
                    <br><i>UI Designer, Tester</i>
                </span>
            </div>
            <div type="bottom">
                <aside style="background-image: url('https://i.imgur.com/ZI3v9wh.png');"></aside>
                <span>
                    Aleksandra Klajda
                    <br><i>UI Designer, Tester</i>
                </span>
            </div>
        </div>
    </div>
</div>

<div class="page" id="infosettings">
    <div class="page-name">
        <svg onClick="history.back();" version="1.0" xmlns="http://www.w3.org/2000/svg" style="height: 20px; width: 20px; position: absolute; left: 15px; margin-top: 2px;" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" style="fill: var(--theme-color); transition: fill 0.5s ease;" stroke="none">
            <path d="M3620 5103 c-39 -13 -198 -168 -1238 -1207 -1095 -1093 -1194 -1195 -1212 -1244 -25 -67 -25 -117 0 -184 18 -49 117 -151 1212 -1244 1141 -1140 1195 -1193 1247 -1209 214 -69 408 147 315 352 -11 25 -377 398 -1093 1115 l-1076 1078 1076 1077 c701 703 1082 1091 1093 1115 61 135 -4 297 -140 348 -64 23 -121 24 -184 3z"/>
            </g>
        </svg>
        Informacje o aplikacji
    </div>
    <div class="page-content">
        <div class="buttons-section" type="text">
            <div type="ind">
                <span>
                    <i>Wersja aplikacji</i>
                    <br>2.0.3
                </span>
            </div>
        </div>
        <button type="button" style="margin-top: 20px;" onclick="location.reload(true);">Zrestartuj aplikację</button>
    </div>
</div>

<div class="menubar" id="menubar">
    <div id="menubar-icons">
        <!--Home icon-->
        <div onclick="window.open('#home', '_self')">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
                <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
                class="menubar-icon selected" stroke="none" id="menubar-home">
                <path d="M2436 5099 c-115 -27 -101 -14 -1264 -1169 -1255 -1246 -1167 -1147
                -1167 -1315 0 -78 4 -98 29 -152 31 -69 107 -148 172 -181 49 -25 138 -42 220
                -42 60 0 63 -1 68 -28 3 -15 8 -414 11 -887 4 -508 10 -885 16 -920 32 -184
                190 -349 373 -390 59 -13 134 -15 451 -13 372 3 381 4 438 26 106 43 207 158
                237 271 8 29 14 246 18 671 6 509 10 630 21 643 12 15 59 17 490 17 358 0 480
                -3 489 -12 9 -9 12 -158 12 -608 0 -342 5 -625 10 -665 20 -137 98 -243 225
                -306 l70 -34 411 -3 c447 -3 491 1 594 53 71 36 171 134 208 203 63 117 62
                103 62 1020 0 893 -2 860 50 907 15 13 43 21 97 26 137 14 241 87 305 217 31
                62 33 73 33 172 0 95 -3 111 -28 162 -24 50 -178 206 -1130 1149 -606 600
                -1124 1107 -1152 1126 -95 64 -248 90 -369 62z m191 -306 c17 -10 516 -499
                1109 -1087 1009 -999 1079 -1071 1082 -1105 2 -25 -3 -45 -17 -63 -17 -21 -31
                -26 -96 -31 -94 -8 -158 -39 -236 -114 -64 -61 -112 -143 -128 -221 -8 -36
                -11 -315 -11 -886 l0 -833 -23 -44 c-13 -24 -43 -57 -66 -74 l-43 -30 -388 -3
                -389 -3 -33 30 -33 29 -5 664 -5 663 -28 57 c-31 64 -94 124 -165 160 l-47 23
                -555 0 -555 0 -52 -27 c-98 -52 -157 -122 -183 -217 -8 -30 -14 -241 -18 -675
                -7 -585 -8 -634 -25 -659 -10 -16 -29 -32 -43 -37 -14 -6 -174 -10 -366 -10
                -327 0 -344 1 -385 21 -48 23 -84 65 -102 118 -8 24 -13 287 -17 890 -3 481
                -9 884 -15 921 -19 124 -85 217 -188 263 -33 15 -76 22 -154 26 -99 5 -111 8
                -128 30 -10 13 -19 34 -19 46 0 18 269 291 1080 1096 594 590 1090 1079 1102
                1086 33 18 108 16 145 -4z"/>
                </g>
            </svg>
        </div>
        <!--Apps icon-->
        <div onclick="window.open('#app', '_self')">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
                <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
                class="menubar-icon" stroke="none" id="menubar-app">
                <path d="M420 5106 c-159 -45 -287 -151 -361 -298 -59 -116 -59 -117 -59 -893
                0 -790 -1 -779 68 -909 70 -134 205 -242 352 -281 84 -22 1489 -22 1574 0 185
                48 341 197 399 380 22 70 22 74 22 810 0 736 0 740 -22 810 -43 138 -147 263
                -272 329 -130 68 -105 66 -921 65 -560 -1 -746 -4 -780 -13z m1538 -305 c67
                -30 127 -98 147 -164 22 -75 22 -1369 0 -1444 -20 -66 -80 -134 -147 -164
                l-53 -24 -685 0 c-553 0 -694 3 -733 14 -57 16 -129 77 -160 135 l-22 41 0
                720 0 720 22 41 c19 36 105 123 122 124 3 1 29 7 56 15 41 11 171 14 725 12
                l675 -2 53 -24z"/>
                <path d="M3111 5104 c-180 -48 -333 -195 -392 -376 l-24 -73 0 -740 0 -740 24
                -73 c60 -184 213 -329 397 -377 85 -22 1490 -22 1574 0 196 52 358 219 405
                416 22 95 22 1453 0 1548 -47 197 -210 364 -405 416 -81 22 -1498 21 -1579 -1z
                m1522 -294 c56 -20 126 -87 153 -145 l24 -50 0 -700 0 -700 -24 -50 c-25 -56
                -86 -115 -143 -142 -35 -17 -89 -18 -738 -18 l-700 0 -57 28 c-32 16 -73 46
                -91 68 -68 79 -67 66 -67 815 0 591 2 679 16 721 30 90 98 154 192 179 71 20
                1381 14 1435 -6z"/>
                <path d="M440 2404 c-185 -40 -348 -187 -412 -372 l-23 -67 0 -755 0 -755 23
                -67 c65 -187 229 -333 419 -373 100 -21 1426 -21 1526 0 211 44 386 223 432
                440 23 108 22 1402 -1 1513 -44 215 -220 393 -433 438 -97 20 -1435 19 -1531
                -2z m1527 -311 c61 -33 110 -88 133 -150 19 -52 20 -76 20 -733 0 -654 -1
                -681 -20 -732 -21 -58 -81 -123 -140 -154 -33 -18 -72 -19 -750 -19 l-715 0
                -53 29 c-30 17 -67 47 -83 67 -60 77 -59 57 -59 808 0 782 -3 749 80 832 82
                81 43 78 840 76 l705 -2 42 -22z"/>
                <path d="M3770 2414 c-148 -19 -282 -60 -415 -127 -113 -56 -187 -109 -284
                -201 -392 -375 -490 -950 -243 -1430 313 -610 1091 -837 1682 -491 601 353
                782 1132 398 1715 -172 262 -451 450 -765 515 -76 16 -304 28 -373 19z m290
                -308 c186 -34 366 -131 496 -268 164 -173 241 -352 251 -583 9 -208 -37 -380
                -148 -544 -181 -271 -487 -426 -804 -408 -574 33 -975 577 -834 1129 89 349
                381 618 736 678 76 12 221 11 303 -4z"/>
                </g>
            </svg>
        </div>
        <!--Calendar icon-->
        <div onclick="window.open('#calendar', '_self')">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
                <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
                class="menubar-icon" stroke="none" id="menubar-calendar">
                <path d="M1220 5109 c-33 -13 -68 -47 -88 -84 -12 -24 -15 -60 -13 -182 l2
                -153 -349 0 c-194 0 -373 -5 -403 -10 -159 -30 -302 -166 -344 -325 -13 -52
                -15 -284 -15 -2005 0 -1716 2 -1953 15 -2005 34 -131 116 -230 242 -292 l77
                -38 2190 -3 c2448 -3 2256 -9 2374 67 110 72 181 181 201 311 14 87 15 3817 1
                3915 -26 183 -169 336 -348 374 -34 7 -183 11 -407 11 l-355 0 0 159 c0 147
                -2 160 -22 191 -40 58 -72 75 -143 75 -71 0 -103 -17 -142 -75 -21 -31 -23
                -44 -23 -191 l0 -159 -1110 0 -1110 0 0 153 c0 139 -2 155 -23 192 -39 70
                -133 103 -207 74z m-103 -786 c-9 -124 18 -189 95 -229 46 -24 127 -15 171 19
                52 40 67 81 67 186 l0 91 1110 0 1110 0 0 -99 c0 -85 3 -102 23 -131 39 -58
                71 -75 142 -75 71 0 103 17 143 75 19 29 22 46 22 132 l0 99 359 -3 c345 -3
                361 -4 387 -24 15 -11 37 -33 48 -48 20 -26 21 -42 24 -337 l3 -309 -2256 0
                -2256 0 3 313 c4 440 -34 406 462 407 l348 0 -5 -67z m3703 -2421 l0 -1469
                -23 -43 c-13 -25 -37 -51 -57 -61 -33 -18 -110 -19 -2181 -19 l-2146 0 -34 23
                c-19 12 -42 38 -51 57 -17 33 -18 126 -18 1508 l0 1472 2255 0 2255 0 0 -1468z"/>
                </g>
            </svg>
        </div>
        <!--Settings icon-->
        <div onclick="window.open('#settings', '_self')">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">
                <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
                class="menubar-icon" stroke="none" id="menubar-settings">
                <path d="M3475 4986 c-221 -51 -397 -190 -495 -391 -27 -55 -52 -117 -56 -137
                l-6 -38 -1407 0 c-1385 0 -1406 0 -1439 -20 -100 -61 -95 -204 8 -257 l44 -23
                1396 0 1396 0 13 -51 c54 -209 244 -410 458 -484 294 -102 618 -10 811 232 58
                71 114 178 133 252 l13 51 336 0 c334 0 337 0 371 23 96 64 87 212 -15 261
                -29 14 -80 16 -364 16 l-330 0 -7 41 c-4 23 -29 86 -57 140 -86 173 -235 302
                -423 365 -98 33 -281 43 -380 20z m287 -307 c217 -73 339 -296 283 -514 -43
                -164 -175 -284 -348 -316 -164 -30 -345 54 -434 202 -118 198 -61 446 133 579
                100 69 248 89 366 49z"/>
                <path d="M1379 3290 c-173 -27 -341 -123 -452 -257 -55 -66 -118 -187 -137
                -260 l-13 -50 -90 -7 c-50 -3 -201 -6 -336 -6 -228 0 -248 -2 -279 -20 -73
                -45 -94 -147 -44 -217 45 -64 57 -65 421 -57 l328 7 7 -39 c11 -57 76 -190
                129 -261 86 -116 241 -220 384 -259 94 -25 236 -29 333 -10 160 32 330 133
                425 254 55 68 117 189 136 261 l13 53 1406 -7 1405 -7 33 21 c100 64 93 215
                -12 265 -31 14 -134 16 -1058 16 -564 0 -1194 3 -1400 7 l-375 6 -13 51 c-17
                67 -76 180 -131 250 -87 112 -244 214 -386 250 -77 20 -220 28 -294 16z m262
                -320 c157 -61 263 -205 276 -375 13 -173 -88 -339 -254 -418 -63 -30 -76 -32
                -173 -32 -97 0 -110 2 -172 32 -325 154 -345 586 -37 766 102 60 247 71 360
                27z"/>
                <path d="M3453 1565 c-175 -47 -329 -153 -424 -291 -39 -57 -88 -162 -103
                -222 l-12 -47 -1410 -5 c-1337 -5 -1411 -6 -1437 -23 -95 -62 -87 -203 13
                -254 l44 -23 1396 0 1395 0 18 -63 c31 -108 91 -203 186 -297 141 -140 276
                -198 476 -207 102 -5 134 -2 204 16 254 64 456 254 526 494 l16 57 338 0 c335
                0 338 0 372 23 96 64 87 212 -15 261 -29 14 -80 16 -363 16 l-329 0 -13 52
                c-8 28 -34 92 -59 142 -88 176 -264 317 -458 366 -93 24 -281 26 -361 5z m303
                -300 c76 -22 168 -88 214 -152 126 -176 115 -392 -27 -544 -89 -95 -190 -139
                -318 -139 -92 0 -158 20 -235 72 -116 77 -190 214 -190 352 1 216 148 387 370
                430 39 7 130 -2 186 -19z"/>
                </g>
            </svg>
        </div>
    </div>
</div>


</div>

</body>
</html>

<script>
//User variables
var userID = localStorage.getItem("userid");
var userFirstName = localStorage.getItem("userfname");  
var userSurname = localStorage.getItem("usersname");
var userNickname = localStorage.getItem("usernickname");
var userClass = localStorage.getItem("userclass");

var ordersdb;
var ticketsdb;

//Colors

function addToSlider() {
    document.getElementById("home-slider").innerHTML += `<li class="slide-visible"> <div style="height: 130px; background-color: #ececec; width: 100%; border-radius: 20px;"> <div style="padding: 20px; height: calc(100% - 40px); width: calc(100% - 40px);"> TEST </div> </div> </li>`;
}

const menubarPages = ["home", "app", "calendar", "settings"];

window.addEventListener("hashchange", function(event) {
    setTimeout(function() {
        for (x in menubarPages) {
            if (window.location.href.endsWith(`${menubarPages[x]}`)) {
                document.getElementById(`menubar-${menubarPages[x]}`).classList.add("selected");
            } else {
                document.getElementById(`menubar-${menubarPages[x]}`).classList.remove("selected");
            }
        }
    }, 10);
});

//App settings
var theme = localStorage.getItem("theme");
if (theme == null) {
    theme = "a80c2f";
}
document.getElementById(`introduction-theme-${theme}`).classList.add("selected");
document.getElementById(`theme-${theme}`).classList.add("selected");
changeTheme(theme);

var lightMode = "default";
if (localStorage.getItem("lightmode") != null) {
    changeLightMode(localStorage.getItem("lightmode"));
}
changeLightMode(lightMode);

//Theme settings
function changeTheme(newTheme) {
    document.getElementById(`introduction-theme-${theme}`).classList.remove("selected");
    document.getElementById(`theme-${theme}`).classList.remove("selected");
    theme = newTheme;
    document.documentElement.style.setProperty("--theme-color", `#${theme}`);
    document.getElementById(`introduction-theme-${theme}`).classList.add("selected");
    document.getElementById(`theme-${theme}`).classList.add("selected");
    localStorage.setItem("theme", theme);
}

//LightMode settings
function changeLightMode(newLightMode) {
    document.getElementById("introduction-lightmode").value = newLightMode;
    document.getElementById("lightmode").value = newLightMode;
    if (newLightMode == "default") {
        localStorage.removeItem("lightmode");
        lightMode = "light";
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            lightMode = "dark";
        }
    } else if (newLightMode == "light") {
        lightMode = "light";
        localStorage.setItem("lightmode", "light");
    } else if (newLightMode == "dark") {
        lightMode = "dark";
        localStorage.setItem("lightmode", "dark");
    }

    if (lightMode == "light") {
        document.documentElement.style.setProperty("--background", "#f9f9f9");
        document.documentElement.style.setProperty("--additional", "#ffffff");
        document.documentElement.style.setProperty("--additional2", "#ececec");
        document.documentElement.style.setProperty("--text", "#000000");
        document.getElementById("manifest").href = "../manifest.webmanifest";
    }
    if (lightMode == "dark") {
        document.documentElement.style.setProperty("--background", "#000000");
        document.documentElement.style.setProperty("--additional", "#1e1e1e");
        document.documentElement.style.setProperty("--additional2", "#121212");
        document.documentElement.style.setProperty("--text", "#ffffff");
        document.getElementById("manifest").href = "../manifest-dark.webmanifest";
    }
}

//Introduction
var introductionStep = 1;
const introductionSteps = 6;
document.getElementById("introduction-progress-bar").style.width = String(introductionStep/introductionSteps*100)+"%";
var loginPopup;
var waitForLogin = false;

window.addEventListener(
  "message",
  (event) => {
    if (waitForLogin == false) {
        return false;
    }
    console.log(event.data);
    var data = JSON.parse(event.data);
    if (data.login == "success") {
        localStorage.setItem("loginid", data.userloginid);
        localStorage.setItem("id", data.userid);
        loginPopup.close();
        introductionNextStep();
        waitForLogin = false;
    }
  },
  false,
);

function switchNotifications() {
    var NotificationIsSupported = !!(window.Notification || window.webkitNotifications || navigator.mozNotification)  
    if (NotificationIsSupported == false) {
        document.getElementById("notificationssettings-switch").checked = "";
        document.getElementById("notificationssettings-details").style.display = "none";
        window.alert("Urządzenie nie obsługuje powiadomień!");
        return false;
    }
    if (document.getElementById("notificationssettings-switch").checked) { //Przełącznik został włączony
        if (Notification.permission == "denied") {
            document.getElementById("notificationssettings-switch").checked = "";
            window.alert("Zezwól na wysyłanie powiadomień przez aplikację Mobilny Katolik w ustawieniach telefonu.\nW razie potrzeby, wyślij zgłoszenie w zakładce Zgłoś problem.");
            return false;
        } else if (Notification.permission == "default" || Notification.permission == "granted") {
            navigator.serviceWorker.getRegistration().then(registration => {
                registration.pushManager.subscribe({
                    applicationServerKey: applicationServerKey,
                    userVisibleOnly: true
                })
                .then((subscription) => {
                    console.log('Subscribed! Endpoint:', JSON.stringify(subscription.toJSON()));
                    var data = {
                        "push": subscription.toJSON(),
                        "userid": localStorage.getItem("id"),
                        "loginid": localStorage.getItem("loginid")
                    }
                    var url = `https://api.mobilnykatolik.repl.co/push/register`;
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("Access-Control-Allow-Origin", "*");

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4) {
                            if (xhr.status == 200) {
                                document.getElementById("notificationssettings-details").style.display = "block";
                                return false;
                            } else {
                                document.getElementById("notificationssettings-switch").checked = "";
                                window.alert("Wystąpił błąd. Spróbuj ponownie!");
                                return false;
                            }
                        }
                    };
                    xhr.send(JSON.stringify(data));
                })
                .catch((error) => {
                    console.log('Subscription failed, error:', error);
                    document.getElementById("notificationssettings-switch").checked = "";
                    window.alert("Zezwól na wysyłanie powiadomień przez aplikację Mobilny Katolik w ustawieniach telefonu.\nW razie potrzeby, wyślij zgłoszenie w zakładce Zgłoś problem.")
                    return false;
                });
            });
        } else {
            document.getElementById("notificationssettings-switch").checked = "";
            window.alert("Wystąpił błąd.\nW razie potrzeby, wyślij zgłoszenie w zakładce Zgłoś problem.")
            return false;
        }
    } else { //Przełącznik został wyłączony
        document.getElementById("notificationssettings-details").style.display = "none";
        var data = {
            "userid": localStorage.getItem("id"),
            "loginid": localStorage.getItem("loginid")
        }
        var url = `https://api.mobilnykatolik.repl.co/push/register`;
        var xhr = new XMLHttpRequest();
        xhr.open("POST", url);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Access-Control-Allow-Origin", "*");

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status == 200) {
                    return false;
                } else {
                    document.getElementById("notificationssettings-switch").checked = "checked";
                    document.getElementById("notificationssettings-details").style.display = "block";
                    window.alert("Wystąpił błąd. Spróbuj ponownie!");
                    return false;
                }
            }
        };
        xhr.send(JSON.stringify(data));
    }
}

function askForPermission() {
    document.getElementById("introduction-ask-for-permission").style.display = "none";
    var NotificationIsSupported = !!(window.Notification || window.webkitNotifications || navigator.mozNotification)  
    if (NotificationIsSupported == false) {
        window.alert("Urządzenie nie obsługuje powiadomień!");
        return false;
    }
    navigator.serviceWorker.getRegistration().then(registration => {
        registration.pushManager.subscribe({
            applicationServerKey: applicationServerKey,
            userVisibleOnly: true
        })
        .then((subscription) => {
            console.log('Subscribed! Endpoint:', JSON.stringify(subscription.toJSON()));
            introductionNextStep();
            var data = {
                "push": subscription.toJSON(),
                "userid": localStorage.getItem("id"),
                "loginid": localStorage.getItem("loginid")
            }
            if (document.getElementById("introduction-nickname").value != "") {
                data.nickname = document.getElementById("introduction-nickname").value;
            }
            var url = `https://api.mobilnykatolik.repl.co/push/register`;
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.setRequestHeader("Access-Control-Allow-Origin", "*");

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    console.log(xhr.status);
                    console.log(xhr.responseText);
            }};

            xhr.send(JSON.stringify(data));
        })
        .catch((error) => {
            console.log('Subscription failed, error:', error);
            introductionNextStep();
        });
    });
}

function introductionNextStep(steps) {
    if (introductionStep == "change") {
        return false;
    }
    var currentIntroductionStep = introductionStep;
    introductionStep = "change";
    if (steps == undefined) {
        steps = 1;
    }
    document.getElementById("introduction-progress-bar").style.width = String((currentIntroductionStep+steps)/introductionSteps*100)+"%";
    document.getElementById("introduction-step-"+currentIntroductionStep).style.opacity = "0%";
    setTimeout(function() {
        document.getElementById("introduction-step-"+currentIntroductionStep).style.display = "none";
        currentIntroductionStep += steps;
        introductionStep = currentIntroductionStep;
        document.getElementById("introduction-step-"+introductionStep).style.display = "block";
        if (introductionStep == 2) {
            openLoginPopup()
        }
    }, 500)
    setTimeout(function() {
        document.getElementById("introduction-step-"+introductionStep).style.opacity = "100%";
    }, 600)
    return false;
}

function openLoginPopup() {
    waitForLogin = true;
    var left = (screen.width/2)-(500/2);
    var top = (screen.height/2)-(650/2);
    loginPopup = window.open("https://auth.mobilnykatolik.repl.co/", "_blank", `toolbar=no,scrollbars=no,resizable=no,top=${top},left=${left},width=500,height=650`);
}

function changeColor(color) {
    document.getElementById("startup-logo-icon-color").style.fill = color;
    document.getElementById("startup-logo-loading-color").style.stroke = color;
}

function hideSplash() {
    document.getElementById("splash-screen").style.opacity = "0%";
    setTimeout(function() {
        document.getElementById("splash-screen").style.display = "none"
    }, 500)
}

function moveStartupLogo() {
    document.getElementById("startup-logo").style.top = "40px";
    document.getElementById("startup-logo-introduction").style.top = "40px";
    document.getElementById("startup-logo-loading").style.opacity = "0%";
    setTimeout(function() {
        document.getElementById("startup-logo-loading").style.display = "none";
        hideSplash();
    }, 2000)
}

function moveStartupLogoBack() {
    document.getElementById("startup-logo").style.display = "none";
    document.getElementById("startup-logo-introduction").style.top = "50%";
    document.getElementById("splash-screen").style.display = "block";
    setTimeout(function() {
        document.getElementById("splash-screen").style.opacity = "100%";
    }, 300)
    setTimeout(function() {
        location.reload();
    }, 2500)
}

function startIntroduction() {
    document.getElementById("menubar").style.display = "none";
    document.getElementById("startup-logo-introduction").style.display = "block";
    document.getElementById("introduction").style.display = "block";
    document.getElementById("introduction-step-"+introductionStep).style.display = "block";
    document.getElementById("introduction-step-"+introductionStep).style.opacity = "100%";
    setTimeout(function() {
        moveStartupLogo();
    }, 500)
}

//Start application
function startApplication() {
    /*window.alert("Trwają prace serwisowe. Dostęp do aplikacji tymczasowo niemożliwy.");
    location.reload();
    return false;*/
    console.log("Uruchamiam aplikację");
    window.location.href = "#home";
    var url = `https://api.mobilnykatolik.repl.co/sync/${loginid}`;

    var xhr = new XMLHttpRequest();
    xhr.open("GET", url);

    xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        if (xhr.status == 200) {
            console.log(JSON.parse(xhr.responseText));
            var data = JSON.parse(xhr.responseText);
            userID = data.id;
            userFirstName = data.firstname;
            userSurname = data.lastname;
            userNickname = data.nickname;
            userClass = data.class;
            if (data.orders != undefined) {
                ordersdb = data.orders;
                loadOrders();
            }
            //
            localStorage.setItem("userid", userID);
            localStorage.setItem("userfname", userFirstName);
            localStorage.setItem("usersname", userSurname);
            localStorage.setItem("usernickname", userNickname);
            localStorage.setItem("userclass", userClass);
            //
            userFirstName = userFirstName.charAt(0).toUpperCase() + userFirstName.slice(1).toLowerCase();
            userSurname = userSurname.charAt(0).toUpperCase() + userSurname.slice(1).toLowerCase();
            //

            //Lucky number
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            const todayDate = `${String(today.getDate()).padStart(2, '0')}.${String(today.getMonth() + 1).padStart(2, '0')}.${today.getFullYear()}`;
            const tomorrowDate = `${String(tomorrow.getDate()).padStart(2, '0')}.${String(tomorrow.getMonth() + 1).padStart(2, '0')}.${tomorrow.getFullYear()}`;
            console.log(data.luckynumber);
            if (data.luckynumber.today != undefined) {
                document.getElementById("ln-today").style.display = "block";
                document.getElementById("ln-today-date").innerHTML = `${todayDate} (dziś)`
                for (group in data.luckynumber.today) {
                    document.getElementById("ln-today-table").innerHTML += `
                    <tr>
                        <td style="text-align: center; vertical-align: middle;">${group.toUpperCase()}</td>
                        <td>${data.luckynumber.today[group].join("<br>")}</td>
                    </tr>`
                }
            }

            if (data.luckynumber.tomorrow != undefined) {
                document.getElementById("ln-tomorrow").style.display = "block";
                document.getElementById("ln-tomorrow-date").innerHTML = `${tomorrowDate} (jutro)`
                for (group in data.luckynumber.tomorrow) {
                    document.getElementById("ln-tomorrow-table").innerHTML += `
                    <tr>
                        <td style="text-align: center; vertical-align: middle;">${group.toUpperCase()}</td>
                        <td>${data.luckynumber.tomorrow[group].join("<br>")}</td>
                    </tr>`
                }
            }

            if (data.luckynumber.today == undefined && data.luckynumber.tomorrow == undefined) {
                document.getElementById("no-luckynumber").style.display = "block";
            }

            //Tickets and coupons
            ticketsdb = data.usertickets;
            for (ticket in data.usertickets) {
                var ticketState, ticketStateColor;
                if (data.usertickets[ticket].cost == data.usertickets[ticket].paid) {
                    ticketState = "Bilet aktywny"
                    ticketStateColor = "#00ff00"
                    if (data.usertickets[ticket].consent_required == true && data.usertickets[ticket].consent == false) {
                        ticketState = "Niedostarczona zgoda"
                        ticketStateColor = "#ff0000"
                    }
                } else {
                    ticketState = "Bilet nieopłacony"
                    ticketStateColor = "#ff0000"
                }
                var ticketData = `<li class="slide-visible" onClick="showTicket('${ticket}')">
                    <div style="height: 130px; background-color: #000000; width: 100%; border-radius: 20px;">
                        <div style="padding: 20px; height: calc(100% - 40px); width: calc(100% - 40px);">
                            <div style="height: 130px; aspect-ratio: 1/1; position: absolute; top: 0; right: 0; border-radius: 0px 20px 20px 0px; background-size: 100%; background-position: center; background-repeat: no-repeat; background-image: url('https://i.imgur.com/LUw9eul.png')"></div>
                            <div style="position: absolute; top: 50%; translate: 0 -50%; width: calc(100% - 40px);">
                                <p style="color: #ffffff;">${data.usertickets[ticket].name}</p>
                                <p style="font-size: 15px; color: ${ticketStateColor};">${ticketState}</p>
                            </div>
                        </div>
                    </div>
                </li>`
                document.getElementById("my-tickets").innerHTML += ticketData;
                document.getElementById("home-slider").innerHTML = ticketData + document.getElementById("home-slider").innerHTML;
            }

            const timestamp = Math.floor(Date.now() / 1000)

            if (["1lo", "2lo", "3lo", "4lo", "n"].includes(userClass) && timestamp >= 1698045300) {
                document.getElementById("crime-party-available").style.display = "none";
            }


            document.getElementById("profile-pic").innerHTML = `${userFirstName.charAt(0)}${userSurname.charAt(0)}`
            document.getElementById("widget-points-qr").style.backgroundImage = `url("https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${userID}&bgcolor=ececec")`
            loadUIdata();
            checkNotifications(data.pushendpoint);
        } else if (xhr.status == 404) {
            localStorage.clear();
            location.reload();
        } else {
            if (window.confirm("Wystąpił problem komunikacji z API. Czy chcesz spróbować ponownie?")) {
                location.reload();
            } else {
                location.reload();
            }
        }
        setTimeout(function() {
            hideSplash();
        }, 500);
    }};

    xhr.send();
}

//Check to start introduction
var loginid = localStorage.getItem("loginid");
if (loginid == null) {
    window.location.href = "#";
    startIntroduction();
} else {
    console.log("Użytkownik zalogowany jako:");
    loginid = localStorage.getItem("loginid");
    console.log({loginid});
    startApplication();
}

function urlB64ToUint8Array(base64String) {
  const padding = '='.repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding)
    .replace(/\-/g, '+')
    .replace(/_/g, '/');

  const rawData = window.atob(base64);
  const outputArray = new Uint8Array(rawData.length);

  for (let i = 0; i < rawData.length; ++i) {
    outputArray[i] = rawData.charCodeAt(i);
  }
  return outputArray;
}


var applicationServerKey = urlB64ToUint8Array("BKYA3uX7SGiQ0YeC-CxulKo66lsFHm1tEtbMvSO-NJst6HkmeYP_gzgQPItcCH--kjxTZE4XG2MZayQLahtrGto");

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('../serviceWorker.js', {
      scope: '/app/'
    }).then((registration) => {
        console.log('SW zarejestrowany! Scope:', registration.scope);
    });
}

function showPopUp() {
    document.getElementById("blur-screen").style.display = "block";
    setTimeout(function() {
            document.getElementById("blur-screen").style.opacity = "100%";
            document.getElementById("popup").style.transform = "scale(1)";
    }, 10);
}

function loadUIdata() {
    if (userNickname != undefined && userNickname != "") {
        document.getElementById("UIname").innerHTML = userNickname;
    } else {
        document.getElementById("UIname").innerHTML = userFirstName;
    }
    document.getElementById("UIfirstname").value = userFirstName;
    document.getElementById("UIsurname").value = userSurname;
    document.getElementById("UIclass").value = userClass.toUpperCase();
    document.getElementById("UInickname").value = userNickname;
}

function nicknameChange() {
    if (document.getElementById("UInickname").value != userNickname) {
        document.getElementById("usersettings-save").disabled = "";
    } else {
        document.getElementById("usersettings-save").disabled = "disabled";
    }
};

function openInstagram() {
    window.location = 'instagram://user?username=katolik.su';
    if (window.location.href == "https://mobilnykatolik.github.io/app/index.html#app" || window.location.href == "https://mobilnykatolik.github.io/app/index.html#home") {
        window.open("https://www.instagram.com/katolik.su/", "_self");
    }
}

function userSettingsSave() {
    var data = {
        "userid": userID,
        "loginid": loginid
    }
    data.nickname = document.getElementById("UInickname").value;
    var url = `https://api.mobilnykatolik.repl.co/data/update`;
    var xhr = new XMLHttpRequest();
    xhr.open("POST", url);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.setRequestHeader("Access-Control-Allow-Origin", "*");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            if (xhr.status == 200) {
                localStorage.setItem("usernickname", document.getElementById("UInickname").value);
                userNickname = localStorage.getItem("usernickname");
                loadUIdata();
                nicknameChange();
            } else {
                window.alert("Wystąpił problem. Spróbuj ponownie!");
            }
    }};

    xhr.send(JSON.stringify(data));
}

const orderStatus = ["Oczekuje na wpłatę", "Zamówienie opłacone", "W realizacji", "Oczekuje na odbiór", "Zakończone", "Zamówienie anulowane"]

function loadOrders() {
    const template = `
    <li class="slide-visible">
        <div style="height: 130px; background-color: var(--additional2); width: 100%; border-radius: 20px;">
            <div style="padding: 20px;height: calc(100% - 40px);width: calc(100% - 40px);">
                <img src="../src/img/shopping-bags.png" style="height: 100%; position: absolute; right: 0; bottom: 0; opacity: 50%; border-radius: 20px;">
                Zamówienie <b class="highlight" style="position: relative;">#[ORDER_ID]</b><br>
                Status: <b class="highlight" style="position: relative;">[ORDER_STATUS]</b>
                <button type="button" class="introduction-button-next" style="margin: auto; position: absolute; left: 0; right: 0; width: fit-content; bottom: 15px;" onclick="showOrder('[ORDER_ID]');">Szczegóły</button>
            </div>
        </div>
    </li>`

    for (order in ordersdb) {
        var orderWindow = template.replaceAll("[ORDER_ID]", order);
        orderWindow = orderWindow.replaceAll("[ORDER_STATUS]", orderStatus[parseInt(ordersdb[order].status)]);
        document.getElementById("home-slider").innerHTML = orderWindow + document.getElementById("home-slider").innerHTML;
    }
}

function loadOrder(orderID) {
    document.getElementById("order-id").innerHTML = `#${orderID}`;
    document.getElementById("order-status").innerHTML = orderStatus[parseInt(ordersdb[orderID].status)];
    document.getElementById("order-price").innerHTML = `${ordersdb[orderID].price},00 zł`
    document.getElementById("order-cost").innerHTML = `${parseInt(ordersdb[orderID].price)-parseInt(ordersdb[orderID].paid)},00 zł`

    var orderDetails = "<tr><td>Produkt</td><td>Opis</td><td>Cena</td></tr>";
    for (pos in ordersdb[orderID].products) {
        var pos = ordersdb[orderID].products[pos];
        orderDetails += `
        <tr>
            <td>${pos.name}</td>
            <td>${pos.size}/${pos.color}/${pos.logotype}</td>
            <td>${pos.price},00 zł</td>
        </tr>
        `
    }
    document.getElementById("order-details").innerHTML = orderDetails;
    document.getElementById("order-payment-title").innerHTML = `Zamówienie SU nr ${orderID}`
}

function showOrder(orderID) {
    window.open("#order", "_self");
    loadOrder(orderID);
}

function loadTicket(ticketID) {
    var ticketData = ticketsdb[ticketID];
    document.getElementById("ticket-name").innerHTML = ticketData.name;
    document.getElementById("ticket-date").innerHTML = ticketData.date;
    document.getElementById("ticket-time").innerHTML = ticketData.time;
    document.getElementById("ticket-place").innerHTML = ticketData.place;
    document.getElementById("ticket-banner").style.backgroundImage = `url("${ticketData.banner_url}")`
    document.getElementById("ticket-qr").style.backgroundImage = `url("https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${ticketID}")`

    var ticketState, ticketStateColor;
    if (ticketData.cost == ticketData.paid) {
        ticketState = "Bilet aktywny"
        ticketStateColor = "#00ff00"
        if (ticketData.consent_required == true && ticketData.consent == false) {
            ticketState = "Niedostarczona zgoda"
            ticketStateColor = "#ff0000"
        }
    } else {
        ticketState = "Bilet nieopłacony"
        ticketStateColor = "#ff0000"
    }

    document.getElementById("ticket-state").innerHTML = ticketState;
    document.getElementById("ticket-state").style.color = ticketStateColor;

}

function showTicket(ticketID) {
    window.open("#ticket", "_self");
    loadTicket(ticketID);
}

function buyTicket(ticketEventID) {
    if (!window.confirm("Czy na pewno chcesz zakupić bilet?")) {
       return false;
    }
    document.getElementById("buy-ticket-button").disabled = "disabled";
    document.getElementById("buy-ticket-button").innerHTML = "Przetwarzanie...";
    var data = {
        "userid": userID,
        "ticket_event_id": "y6w6z19y"
    }
    var url = `https://api.mobilnykatolik.repl.co/tickets/add`;
    var xhr = new XMLHttpRequest();
    xhr.open("POST", url);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.setRequestHeader("Access-Control-Allow-Origin", "*");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            if (xhr.status == 200) {
                location.reload();
                return false;
            } else {
                window.alert(xhr.responseText);
                document.getElementById("buy-ticket-button").disabled = "";
                document.getElementById("buy-ticket-button").innerHTML = "Zamawiam z obowiązkiem zapłaty";
                return false;
            }
        }
    };
    xhr.send(JSON.stringify(data));
}

function checkNotifications(endpoint) {
    var deviceEndpoint;
    var apiEndpoint = endpoint;
    console.log("Sprawdzanie działania powiadomień")
    var NotificationIsSupported = !!(window.Notification || window.webkitNotifications || navigator.mozNotification)  
    if (NotificationIsSupported == false) {
        console.log("Urządzenie nie obsługuje powiadomień!");
        return false;
    }
    if (Notification.permission === "granted") {
        console.log("Uprawnienia do powiadomień przyznane")
        navigator.serviceWorker.getRegistration().then(registration => {
            registration.pushManager
                .getSubscription()
                .then((subscription) => {
                    deviceEndpoint = subscription.endpoint;
                    console.log(subscription.getKey("p256dh"));
                    console.log(subscription.getKey("auth"));
                    console.log(subscription.toJSON());
                    if (deviceEndpoint == apiEndpoint) {
                        document.getElementById("notificationssettings-switch").checked = "checked";
                        document.getElementById("notificationssettings-details").style.display = "block";
                        console.log("Powiadomienia w API są zgodne z obecnym urządzeniem");
                    }
                });
            
        });
    } else {
        console.log("Brak uprawnień do powiadomień");
    }
}

</script>